# FilmHub

FilmHub — это учебный **pet-проект**, вдохновлённый функциональностью «Кинопоиска»: каталог фильмов, пользовательские рейтинги, рецензии и базовые административные возможности. Проект написан на Go (версия ≥ 1.22) с использованием фреймворка **Gin** и современными практиками разработки на 2025 год.

> Проект создан для демонстрации чистой архитектуры, слоистого приложения и CI-friendly кодовой базы с высоким покрытием тестами.

---

## Возможности

* Аутентификация JWT (регистрация, логин, роли `user` / `moderator` / `admin`).
* CRUD для фильмов + полнотекстовый поиск (ILIKE) по названию и описанию.
* Рейтинги и пользовательские отзывы (планируется — TODO).
* Логи c Zap, отправка ошибок в Sentry.
* Миграции БД через [golang-migrate](https://github.com/golang-migrate/migrate).
* Документация API в Swagger (OpenAPI 3).
* Docker-композиция для локального запуска (`docker compose up -d`).
* 100 % unit-тесты бизнес-логики + интеграционные тесты хэндлеров.

## Стек технологий

| Подсистема        | Технологии                          |
|-------------------|--------------------------------------|
| HTTP API          | Go + Gin                            |
| База данных       | PostgreSQL 15                       |
| Миграции          | golang-migrate                      |
| Аутентификация    | JWT (v5)                            |
| DI / Логи         | Wire (план) / Zap + Sentry          |
| Тесты             | Go testing, httptest, Testcontainers |

## Архитектура

```
cmd/            — точка входа, Wire-инициализация зависимостей
internal/
  handler/      — слой transport (HTTP) / DTO
  service/      — бизнес-логика, use-cases
  repository/   — доступ к Postgres (pgx-pool)
  models/       — общие доменные сущности
pkg/            — переиспользуемые пакеты (logger, jwt, db, …)
```

*Чистая архитектура*: зависимости направлены из внешних слоёв во внутренние, бизнес-правила не зависят от инфраструктуры.

## Быстрый старт

1. Скопируйте `.env.example` → `.env` и заполните переменные (см. таблицу ниже).
2. Запустите контейнеры:
   ```bash
   docker compose up -d # postgres, swagger-ui, sentry (опц.)
   ```
3. Запустите сервер:
   ```bash
   go run ./cmd
   ```
4. Откройте Swagger UI → http://localhost:8080/swagger/index.html

### Важные переменные окружения

| Переменная      | Значение по умолчанию | Описание                               |
|-----------------|------------------------|----------------------------------------|
| `DB_HOST`       | `localhost`           | Хост БД                                |
| `DB_PORT`       | `5432`                | Порт БД                                |
| `DB_USER`       | `postgres`            | Пользователь                           |
| `DB_PASSWORD`   | `postgres`            | Пароль                                 |
| `DB_NAME`       | `filmhub`             | Название базы                          |
| `JWT_SECRET`    | `supersecretkey`      | Секрет для подписи JWT                 |
| `APP_ENV`       | `dev`                 | `dev` / `prod`                         |
| `SENTRY_DSN`    | ―                     | DSN проекта в Sentry (опционально)     |

## Тесты

```
go test ./...
```

*В проекте присутствуют юнит-тесты слоёв service и pkg, а также интеграционные тесты HTTP-хэндлеров с использованием `httptest` (см. каталог `internal/handler/_test.go`). Покрытие стремится к `≥ 90 %`.*

## Планы по развитию

- [ ] Модуль «Отчёты и рекомендации».
- [ ] Переход на gRPC-шину для внутренних сервисов.
- [ ] Канареечные деплои через Kubernetes.
- [ ] Настройка CI (Go Vet, lint, тесты, Docker build, SBOM).

## Лицензия

MIT © 2025
